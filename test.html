<!doctype html>
<html lang='en'>

<head>
    <script>
        (function () {
            const isLocal = ['localhost', '127.0.0.1', '::1'].includes(location.hostname);
            const baseHref = isLocal ? '/' : '/gen-ai-demo/';
            const base = document.createElement('base');
            base.setAttribute('href', baseHref);
            document.head.prepend(base); // insert as the first element in <head>
        })();
    </script>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css' rel='stylesheet'>
    <script src='https://cdn.jsdelivr.net/npm/bootstrap/dist/js/bootstrap.bundle.min.js'></script>
    <link rel='stylesheet' href='css/style.css'>

    <title>Generative AI Demo</title>
    <link rel='icon' href='images/favicon.ico' type='image/x-icon'>
</head>

<body>

    <div class="mb-2 d-flex">
        <input id="userInput" class="form-control me-2" placeholder="Ask something…">
        <button id="sendButton" class="btn btn-primary">Send</button>
    </div>

    <div id="status" class="text-muted"></div>

    <script>
        const input = document.getElementById("userInput");
        const sendBtn = document.getElementById("sendButton");
        const statusEl = document.getElementById("status");

        let thinkingTimer = null;
        let dotCount = 0;

        function startThinking(baseText = "Thinking") {
            // Clear any previous timer before starting a new one
            stopThinking();
            dotCount = 0;
            statusEl.textContent = baseText;

            thinkingTimer = setInterval(() => {
                dotCount = (dotCount + 1) % 4; // 0..3
                statusEl.textContent = baseText + ".".repeat(dotCount);
            }, 500); // adjust speed if you like
        }

        function stopThinking(replacementText = "") {
            if (thinkingTimer) {
                clearInterval(thinkingTimer);
                thinkingTimer = null;
            }
            if (replacementText !== null) {
                statusEl.textContent = replacementText;
            }
        }

        async function handleSend() {
            const q = input.value.trim();
            if (!q) {
                // Optional: nudge the user
                statusEl.textContent = "Please enter a question.";
                input.focus();
                return;
            }

            sendBtn.disabled = true;
            startThinking("Thinking");

            try {
                // Replace this fetch with your real API call
                const res = await fakeApiCall(q);
                stopThinking(res.answer); // replace the "Thinking..." with the API result
            } catch (err) {
                stopThinking("Something went wrong. Try again.");
                console.error(err);
            } finally {
                sendBtn.disabled = false;
            }
        }

        // Wire up the click + Enter key
        sendBtn.addEventListener("click", handleSend);
        input.addEventListener("keydown", (e) => {
            if (e.key === "Enter") handleSend();
        });

        // Demo mock API – swap this for your real fetch
        function fakeApiCall(q) {
            return new Promise((resolve) => {
                setTimeout(() => resolve({ answer: `API says: ${q.toUpperCase()}` }), 1800);
            });
        }
    </script>


    <script src='js/helpers.js'></script>
    <script src='js/script.js'></script>

</body>

</html>